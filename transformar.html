<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Transformar imagen</title>
</head>
<body>
  <input type="file" id="inputImage" accept="image/*">
  <img id="resultImage">
  <script>
    const inputImage = document.getElementById('inputImage');
    inputImage.addEventListener('change', function() {
      const file = inputImage.files[0];
      const reader = new FileReader();
      reader.onload = function() {
        const image = new Image();
        image.onload = function() {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          const size = Math.min(image.width, image.height, 400);
          canvas.width = size;
          canvas.height = size;
          const x = (size - image.width) / 2;
          const y = (size - image.height) / 2;
          ctx.fillStyle = 'transparent';
          ctx.fillRect(0, 0, size, size);
          ctx.drawImage(image, x, y);
          canvas.toBlob(function(blob) {
            const formData = new FormData();
            formData.append('image', blob, file.name);
            fetch('transform.php', {
              method: 'POST',
              body: formData
            })
            .then(response => response.blob())
            .then(blob => {
              const imageUrl = URL.createObjectURL(blob);
              const resultImage = document.getElementById('resultImage');
              resultImage.setAttribute('src', 'data:image/jpeg;base64,' + btoa(imageUrl));
              resultImage.src = imageUrl;
            });
          }, 'image/jpeg', 1);
        };
        image.src = reader.result;
      };
      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
